<div *ngIf="monthlyReport" class="container-fluid">

  <mat-card class="mat-elevation-z10 mt-3">
    <mat-card-subtitle>{{FUNCTIONS[monthlyReport.employee.workDescription]}}</mat-card-subtitle>
    <mat-card-content>
      {{monthlyReport.employee.firstName}} {{monthlyReport.employee.sureName}}
      <span
        class="float-right">
        {{
        isValidDate(monthlyReport.employee.releaseDate) ?
          (getDateOfReport(monthlyReport.employee.releaseDate) | date: 'MMMM yyyy' : null : 'de-AT') :
          'Noch nicht freigegeben'
        }}
        </span>
    </mat-card-content>
  </mat-card>

  <div *ngIf="isValidDate(monthlyReport.employee.releaseDate); else invalidReleaseDate" class="row">
    <div class="col-lg-4 mega-check">
      <mat-card class="mat-elevation-z10">
        <mat-card-title>MEGA Pausen Check</mat-card-title>

        <mat-card-content
          *ngIf="monthlyReport.timeWarnings.length === 0; else timeContent"
          class="d-flex text-center justify-content-center align-items-center">
          <div>
            <mat-icon class="green">check_circle</mat-icon>
            <p>Alle Eingaben sind korrekt</p>
          </div>
        </mat-card-content>

        <ng-template #timeContent>
          <mat-card-content *ngIf="monthlyReport.timeWarnings.length > 0">
            <mat-table [dataSource]="monthlyReport.timeWarnings">
              <ng-container matColumnDef="dateTime">
                <mat-header-cell *matHeaderCellDef>Tag</mat-header-cell>
                <mat-cell
                  *matCellDef="let timeEntry"> {{timeEntry.date | date:'E dd.MM.yyyy' : null : 'de-AT'}} </mat-cell>
              </ng-container>

              <ng-container matColumnDef="restTime">
                <mat-header-cell *matHeaderCellDef>zu wenig Ruhezeit</mat-header-cell>
                <mat-cell *matCellDef="let timeEntry"> {{timeEntry.missingRestTime}} </mat-cell>
              </ng-container>

              <ng-container matColumnDef="breakTime">
                <mat-header-cell *matHeaderCellDef>zu wenig Pausenzeit</mat-header-cell>
                <mat-cell *matCellDef="let timeEntry"> {{timeEntry.missingBreakTime}} </mat-cell>
              </ng-container>

              <ng-container matColumnDef="workingTime">
                <mat-header-cell *matHeaderCellDef>zu viel Arbeitszeit</mat-header-cell>
                <mat-cell *matCellDef="let timeEntry"> {{timeEntry.excessWorkTime}} </mat-cell>
              </ng-container>

              <mat-row *matRowDef="let row; columns: displayedColumnsTimeTable;"></mat-row>
              <mat-header-row
                *matHeaderRowDef="displayedColumnsTimeTable; sticky: true"
                mat-header-row>
              </mat-header-row>
            </mat-table>
          </mat-card-content>
        </ng-template>
      </mat-card>

      <mat-card class="mat-elevation-z10">
        <mat-card-title>MEGA Reisen Check</mat-card-title>

        <mat-card-content
          *ngIf="monthlyReport.journeyWarnings.length === 0; else journeyContent"
          class="d-flex text-center justify-content-center align-items-center">
          <div>
            <mat-icon class="green">check_circle</mat-icon>
            <p>Alle Eingaben sind korrekt</p>
          </div>
        </mat-card-content>

        <ng-template #journeyContent>
          <mat-card-content>
            <mat-table [dataSource]="monthlyReport.journeyWarnings">
              <ng-container matColumnDef="dateJourney">
                <mat-header-cell
                  *matHeaderCellDef
                  class="mat-column-date-journey">
                  Tag
                </mat-header-cell>
                <mat-cell
                  class="mat-column-date-journey"
                  *matCellDef="let journeyEntry"> {{journeyEntry.date | date:'E dd.MM.yyyy' : null : 'de-AT'}} </mat-cell>
              </ng-container>

              <ng-container matColumnDef="warningJourney">
                <mat-header-cell *matHeaderCellDef>Warnung</mat-header-cell>
                <mat-cell *matCellDef="let journeyEntry">
                  {{getJourneyWarningString(journeyEntry.warnings)}}
                </mat-cell>
              </ng-container>

              <mat-row
                *matRowDef="let row; columns: displayedColumnsJourneyTable;">
              </mat-row>

              <mat-header-row
                *matHeaderRowDef="displayedColumnsJourneyTable; sticky: true"
                mat-header-row>
              </mat-header-row>
            </mat-table>
          </mat-card-content>
        </ng-template>
      </mat-card>
    </div>

    <div class="col-lg-8 employee-checks">
      <mat-card class="mat-elevation-z10">
        <mat-card-title>Status zum Monatsabschluss</mat-card-title>

        <mat-card-content class="d-flex text-center align-items-center">
          <div class="m-auto">

            <div *ngIf="!areAllCommentsDone(); else commentsOpen">
              <mat-icon class="red">cancel</mat-icon>
              <p>Einige Anmerkungen sind abzuarbeiten:</p>
              <mat-selection-list class="align-middle">
                <mat-list-option
                  #option
                  *ngFor="let comment of monthlyReport.comments"
                  checkboxPosition="before"
                  [ngClass]="option.selected ? 'done green' : 'red'"
                  [selected]="comment.state === DONE">
                  {{comment.creationDate | date: 'dd.MM.yyyy'}}
                  {{formatAuthorName(comment.author)}}:
                  {{comment.message}}
                </mat-list-option>
              </mat-selection-list>
            </div>

            <ng-template #commentsOpen>
              <div *ngIf="monthlyReport.emcState === OPEN && monthlyReport.comments.length === 0">
                <p>Bitte überprüfe deine Eingaben (Zeiten, Reisen, Belege, ...) in ZEP und beim Kunden und bestätige
                  diese anschließend.</p>
                <button mat-raised-button matTooltip="dieser Button tut noch nichts">Buchungen bestätigen</button>
              </div>

              <div *ngIf="monthlyReport.emcState === DONE && monthlyReport.comments.length === 0">
                <mat-icon color="primary">error</mat-icon>
                <p>Monatsabschlusstätigkeiten sind im Gange.</p>
              </div>

              <div *ngIf="monthlyReport.emcState === DONE && areAllCommentsDone()">
                <mat-icon class="green">check_circle</mat-icon>
                <p>Deine Zeiten wurden kontrolliert und sind richtig.</p>
                <p>Bis nächsten Monat!</p>
              </div>
            </ng-template>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <ng-template #invalidReleaseDate>
    <mat-card>
      <mat-card-title>Zeitenkontrolle nicht möglich</mat-card-title>
      <mat-card-content>
        <p>Freigabe der Zeiten ausständig. Bitte wende dich an deinen Mentor.</p>
      </mat-card-content>
    </mat-card>
  </ng-template>

</div>
