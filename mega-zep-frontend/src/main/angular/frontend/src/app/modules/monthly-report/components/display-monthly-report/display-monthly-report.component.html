<div *ngIf="monthlyReport" fxFlexAlign="center" fxFlexFill fxLayout="column" fxLayoutGap="10px">

  <mat-card class="mat-elevation-z10">
    <mat-card-subtitle>{{FUNCTIONS[monthlyReport.employee.workDescription]}}</mat-card-subtitle>
    <mat-card-content>
      {{monthlyReport.employee.firstName}} {{monthlyReport.employee.sureName}}
      <span style="float: right">
        {{ isValidDate(monthlyReport.employee.releaseDate) ?
        (getDateOfReport(monthlyReport.employee.releaseDate) | date: 'MMMM yyyy' : null : 'de-AT') :
        ('monthly-report.notReleasedYet' | translate) }}
        </span>
    </mat-card-content>
  </mat-card>

  <div *ngIf="isValidDate(monthlyReport.employee.releaseDate); else invalidReleaseDate" fxFlex="80%" fxLayout="row"
       fxLayout.lt-lg="column" fxLayoutAlign="flex-start"
       fxLayoutGap="10px">
    <div fxFlex.gt-md="30" fxFlexOrder.lt-lg="2" fxLayout="column" fxLayoutGap="10px">
      <!--Time table-->
      <mat-card class="mat-elevation-z10" fxFlex="50">
        <mat-card-title>
          {{'monthly-report.title.time' | translate}}
        </mat-card-title>

        <mat-card-content
          *ngIf="monthlyReport.timeWarnings.length === 0; else timeContent"
          fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="60px">
          <mat-icon class="green">check_circle</mat-icon>
          <p>{{'monthly-report.ok' | translate}}</p>
        </mat-card-content>

        <ng-template #timeContent>
          <mat-card-content *ngIf="monthlyReport.timeWarnings.length > 0">
            <mat-table [dataSource]="monthlyReport.timeWarnings">
              <ng-container matColumnDef="dateTime">
                <mat-header-cell *matHeaderCellDef>
                  {{'monthly-report.table.time.day' | translate}}
                </mat-header-cell>
                <mat-cell
                  *matCellDef="let timeEntry">{{timeEntry.date | date:'E dd.MM.yyyy' : null : 'de-AT'}} </mat-cell>
              </ng-container>

              <ng-container matColumnDef="restTime">
                <mat-header-cell *matHeaderCellDef>
                  {{'monthly-report.table.time.missingRestTime' | translate}}
                </mat-header-cell>
                <mat-cell *matCellDef="let timeEntry"> {{timeEntry.missingRestTime}} </mat-cell>
              </ng-container>

              <ng-container matColumnDef="breakTime">
                <mat-header-cell *matHeaderCellDef>
                  {{'monthly-report.table.time.missingBreakTime' | translate}}
                </mat-header-cell>
                <mat-cell *matCellDef="let timeEntry"> {{timeEntry.missingBreakTime}} </mat-cell>
              </ng-container>

              <ng-container matColumnDef="workingTime">
                <mat-header-cell *matHeaderCellDef>
                  {{'monthly-report.table.time.excessWorkTime' | translate}}
                </mat-header-cell>
                <mat-cell *matCellDef="let timeEntry"> {{timeEntry.excessWorkTime}} </mat-cell>
              </ng-container>

              <mat-row *matRowDef="let row; columns: displayedColumnsTimeTable;"></mat-row>
              <mat-header-row
                *matHeaderRowDef="displayedColumnsTimeTable; sticky: true"
                mat-header-row>
              </mat-header-row>
            </mat-table>
          </mat-card-content>
        </ng-template>
      </mat-card>
      <!--Journey table-->
      <mat-card class="mat-elevation-z10" fxFlex="49">
        <mat-card-title>
          {{'monthly-report.title.journey' | translate}}
        </mat-card-title>

        <mat-card-content
          *ngIf="monthlyReport.journeyWarnings.length === 0; else journeyContent"
          fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="60px">
          <mat-icon class="green">check_circle</mat-icon>
          <p>{{'monthly-report.ok' | translate}}</p>
        </mat-card-content>

        <ng-template #journeyContent>
          <mat-card-content>
            <mat-table [dataSource]="monthlyReport.journeyWarnings">
              <ng-container matColumnDef="dateJourney">
                <mat-header-cell
                  *matHeaderCellDef
                  class="mat-column-date-journey">
                  {{'monthly-report.table.journey.day' | translate}}
                </mat-header-cell>
                <mat-cell
                  class="mat-column-date-journey"
                  *matCellDef="let journeyEntry">{{journeyEntry.date | date:'E dd.MM.yyyy' : null : 'de-AT'}}</mat-cell>
              </ng-container>

              <ng-container matColumnDef="warningJourney">
                <mat-header-cell *matHeaderCellDef>
                  {{'monthly-report.table.journey.warning' | translate}}
                </mat-header-cell>
                <mat-cell *matCellDef="let journeyEntry">
                  {{getJourneyWarningString(journeyEntry.warnings)}}
                </mat-cell>
              </ng-container>

              <mat-row
                *matRowDef="let row; columns: displayedColumnsJourneyTable;">
              </mat-row>

              <mat-header-row
                *matHeaderRowDef="displayedColumnsJourneyTable; sticky: true"
                mat-header-row>
              </mat-header-row>
            </mat-table>
          </mat-card-content>
        </ng-template>
      </mat-card>
    </div>
    <!--monthly report-->
    <mat-card class="mat-elevation-z10" fxFlex.gt-md="70" fxFlexOrder.lt-lg="1">
      <mat-card-title>{{'monthly-report.title.emc' | translate}}</mat-card-title>
      <mat-card-content>
        <div fxLayout="column" fxLayoutAlign="center center"
             fxLayoutGap="60px" style="overflow: auto; width: 100%; text-align: center">
          <div *ngIf="areAllCommentsDone(), else openComments">
            <div [ngSwitch]="monthlyReport.employeeCheckState">
              <div *ngSwitchCase="State.OPEN">
                <mat-icon class="red">cancel</mat-icon>
                <p>{{'monthly-report.pleaseCheckPrompt' | translate}}</p>
                <button mat-raised-button>{{'monthly-report.confirmBtnText' | translate}}</button>
              </div>

              <div *ngSwitchCase="State.DONE">
                <div *ngIf="!monthlyReport.otherChecksDone">
                  <mat-icon class="yellow">error</mat-icon>
                  <p>{{'monthly-report.checkWip' | translate}}</p>
                </div>
                <div *ngIf="monthlyReport.otherChecksDone">
                  <mat-icon class="green">check_circle</mat-icon>
                  <p>{{'monthly-report.checkSuccess' | translate}}</p>
                </div>
              </div>
            </div>
          </div>

          <ng-template #openComments>
            <mat-icon class="red">cancel</mat-icon>
            <p>{{'monthly-report.commentsToDo' | translate}}:</p>
            <mat-selection-list (selectionChange)="selectionChange($event)" class="align-middle">
              <mat-list-option
                #option
                *ngFor="let comment of monthlyReport.comments"
                [disabled]="option.selected"
                [ngClass]="option.selected ? 'done green' : 'red'"
                [selected]="comment.state === State.DONE"
                [value]="comment"
                checkboxPosition="before">
                {{comment.updateDate | date: 'dd.MM.yyyy'}}
                {{comment.author}}:
                {{comment.message}}
              </mat-list-option>
            </mat-selection-list>
          </ng-template>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <ng-template #invalidReleaseDate>
    <mat-card class="mat-elevation-z10">
      <mat-card-title>{{'monthly-report.timeCheckNotPossible' | translate}}</mat-card-title>
      <mat-card-content>
        <p>{{'monthly-report.timeCheckNotPossiblePrompt' | translate }}</p>
      </mat-card-content>
    </mat-card>
  </ng-template>

</div>
